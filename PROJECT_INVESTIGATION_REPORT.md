# 退職診断アプリケーション - プロジェクト調査報告書

**調査日**: 2025年6月23日  
**プロジェクト名**: retirement-diagnosis-app  
**技術スタック**: Next.js 15.2.4 + React 19 + TypeScript + Supabase + Anthropic Claude

---

## 1. プロジェクト概要

### 1.1 アプリケーションの目的
退職・転職に関する悩みを持つユーザーに対し、AI（Claude 3.5 Sonnet）を活用したパーソナライズされた診断とアドバイスを提供するWebアプリケーション。

### 1.2 主要機能
- **AI退職診断**: 段階的な質問による状況分析
- **パーソナライズされたサービス推奨**: ユーザーの状況に応じた転職・相談サービスの提案
- **匿名利用**: 個人情報登録不要でのサービス利用
- **管理画面**: Basic認証による診断データの閲覧・分析

### 1.3 対象ユーザー
- 現在の仕事に悩みを持つ社会人
- 転職を検討している人
- キャリアについて相談したい人

---

## 2. 技術アーキテクチャ

### 2.1 フロントエンド
```
Next.js 15.2.4 (App Router)
├── React 19
├── TypeScript 5
├── Tailwind CSS 3.4.17
├── Radix UI コンポーネント（多数）
└── Lucide React アイコン
```

### 2.2 バックエンド・インフラ
```
Vercel (デプロイ環境推定)
├── Next.js API Routes
├── Supabase (データベース)
├── Anthropic Claude 3.5 Sonnet (AI分析)
└── Google Sheets API (ログ記録)
```

### 2.3 開発・テスト環境
```
開発環境
├── Jest 30.0.0 (テストフレームワーク)
├── Testing Library (React/Jest DOM)
├── ESLint + TypeScript (品質管理)
└── pnpm/npm/yarn (パッケージ管理)
```

---

## 3. プロジェクト構造詳細

### 3.1 ディレクトリ構成
```
retirement-diagnosis-app/
├── app/                    # Next.js App Router
│   ├── admin/             # 管理画面（Basic認証）
│   ├── api/               # APIエンドポイント（7個）
│   ├── diagnosis/         # V1診断フロー
│   ├── v2/                # V2診断フロー
│   └── privacy/           # プライバシーポリシー
├── components/            # 共通コンポーネント
│   └── ui/               # Radix UI ベースUIコンポーネント
├── lib/                   # ユーティリティ・ロジック
│   ├── v2/               # V2診断専用ロジック
│   └── utils/            # 共通ユーティリティ
├── __tests__/            # テストファイル
└── hooks/                # React カスタムフック
```

### 3.2 重要ファイル
- `middleware.ts`: Basic認証（管理画面保護）
- `next.config.mjs`: ビルド設定（ESLint/TypeScript エラー無視）
- `jest.config.js`: テスト設定
- `tailwind.config.ts`: スタイリング設定

---

## 4. 機能詳細分析

### 4.1 診断フロー

#### V1診断（従来版）
```
1. 基本5問診断 → AI簡易分析
2. テキスト入力 → 詳細分析
3. AI問答セッション（最大5回）
4. 最終診断結果生成
5. サービス推奨表示
```

#### V2診断（新版）
```
1. 改良された質問構造
2. 一括AI分析・診断
3. スマートサービス推奨
4. 結果表示
```

### 4.2 AI分析エンジン

**使用モデル**: Claude 3.5 Sonnet (claude-3-5-sonnet-20241022)

**分析項目**:
- 感情状態分析
- 緊急度レベル判定（高/中/低）
- 診断タイプ分類
- 個別アドバイス生成
- サービス推奨

### 4.3 データ管理

#### Supabase テーブル: `career_user_diagnosis`
```sql
主要フィールド:
- user_id: ユーザー識別子
- session_id: セッション識別子
- answers: 診断回答データ（JSON）
- ai_chat_history: AI問答履歴
- clicked_services: クリックサービス履歴
- created_at/updated_at: タイムスタンプ（JST）
```

---

## 5. APIエンドポイント詳細

### 5.1 API一覧
| エンドポイント | 機能 | 入力 | 出力 |
|---------------|------|------|------|
| `/api/ai-chat` | AI質問生成 | 基本診断+履歴 | 次の質問 |
| `/api/analyze-basic` | 基本診断分析 | 5問回答 | 簡易診断結果 |
| `/api/analyze-text` | テキスト分析 | 基本結果+テキスト | 詳細分析 |
| `/api/final-analysis` | 最終診断 | 全診断データ | 最終結果+推奨 |
| `/api/save-diagnosis` | V1データ保存 | 診断データ | 保存結果 |
| `/api/save-v2-diagnosis` | V2データ保存 | V2診断データ | 保存結果 |
| `/api/log` | 行動ログ | ユーザー行動 | Google Sheets記録 |

### 5.2 外部サービス連携
- **Anthropic API**: 全AI分析処理
- **Supabase**: データ永続化
- **Google Sheets API**: 行動ログ記録
- **Vercel Edge**: IP地域情報取得

---

## 6. テスト戦略

### 6.1 テスト構成
```
Jest + Testing Library
├── Unit Tests
│   ├── タイムスタンプユーティリティ
│   ├── V2データベース操作
│   └── V2セッション管理
├── Component Tests (設定済み)
└── Integration Tests (設定済み)
```

### 6.2 テスト対象
- ユーティリティ関数の動作検証
- データベース操作の信頼性
- セッション管理の整合性
- UI コンポーネントの動作（設定済み）

### 6.3 モック戦略
- Supabase クライアントのモック
- sessionStorage のモック
- fetch API のモック
- 暗号化ユーティリティのモック

---

## 7. セキュリティ・プライバシー

### 7.1 セキュリティ対策
- **Basic認証**: 管理画面保護
- **環境変数**: API キー等の秘匿情報管理
- **CORS設定**: 適切なオリジン制限
- **入力検証**: APIレベルでのデータ検証

### 7.2 プライバシー配慮
- **匿名利用**: 個人情報登録不要
- **データ最小化**: 必要最小限の情報のみ収集
- **透明性**: プライバシーポリシーページの設置

---

## 8. パフォーマンス・品質

### 8.1 最適化設定
```typescript
// next.config.mjs
{
  eslint: { ignoreDuringBuilds: true },
  typescript: { ignoreBuildErrors: true },
  images: { unoptimized: true }
}
```

### 8.2 品質管理
- **TypeScript**: 型安全性の確保
- **ESLint**: コード品質の統一
- **Jest**: 自動テストによる品質保証
- **Tailwind CSS**: 一貫したスタイリング

---

## 9. 運用・監視

### 9.1 ログ・分析
- **Google Analytics**: ユーザー動線分析
- **Facebook Pixel**: 広告効果測定
- **Google Sheets**: 詳細行動ログ
- **Supabase**: 診断データ分析

### 9.2 管理機能
- **管理画面**: `/admin` - 診断データ閲覧
- **リフレッシュ機能**: データの最新化
- **Basic認証**: 安全な管理者アクセス

---

## 10. 技術的課題・改善点

### 10.1 現在の課題
1. **ビルド設定**: ESLint/TypeScript エラーを無視している
2. **テストカバレッジ**: APIルートのテストが不足
3. **エラーハンドリング**: 一部のエラー処理が不完全

### 10.2 推奨改善策
1. **品質向上**: ESLint/TypeScript エラーの修正
2. **テスト拡充**: API エンドポイントの統合テスト追加
3. **監視強化**: エラー監視・アラート機能の導入
4. **パフォーマンス**: 画像最適化の有効化

---

## 11. スケーラビリティ

### 11.1 現在の制約
- Supabase の利用制限
- Anthropic API のレート制限
- Google Sheets API の書き込み制限

### 11.2 スケール対応
- データベースの水平分散検討
- API キャッシュ機能の導入
- CDN を活用した静的ファイル配信

---

## 12. 総合評価

### 12.1 技術的強み
✅ **最新技術スタック**: Next.js 15 + React 19  
✅ **AI統合**: Claude 3.5 Sonnet による高品質分析  
✅ **フルスタック**: フロントエンドからバックエンドまで統合  
✅ **テスト基盤**: Jest による自動テスト環境  
✅ **型安全性**: TypeScript による開発効率向上  

### 12.2 ビジネス価値
✅ **ユーザー価値**: 具体的な悩み解決サービス  
✅ **収益化モデル**: サービス推奨による収益化  
✅ **スケーラビリティ**: クラウドサービス活用  
✅ **データ活用**: 蓄積データによる改善サイクル  

### 12.3 開発・運用面
⚠️ **品質管理**: ビルドエラー無視の設定要改善  
⚠️ **テスト**: API層のテストカバレッジ向上必要  
✅ **デプロイ**: Vercel による自動デプロイ環境  
✅ **監視**: 複数チャネルでの分析・ログ収集  

---

## 13. 結論

本プロジェクトは、**最新のフルスタック技術を活用したAI診断サービス**として、技術的にもビジネス的にも優秀な基盤を持っています。特に、Claude 3.5 Sonnetの統合により高品質なAI分析を実現し、段階的な診断フローによってユーザー体験を最適化している点が評価できます。

**即座に対応すべき点**:
1. ビルド設定の改善（ESLint/TypeScript エラー修正）
2. API層のテスト追加

**中長期的な発展方向**:
1. 診断精度の継続的改善
2. サービス推奨アルゴリズムの高度化
3. ユーザーフィードバック機能の追加

このプロジェクトは、技術的な土台がしっかりしており、継続的な改善により更なる価値提供が期待できる優秀なプロダクトです。

---

**調査者**: Claude Code  
**調査方法**: ソースコード解析、設定ファイル確認、依存関係分析  
**調査範囲**: プロジェクト全体（フロントエンド、バックエンド、テスト、設定）